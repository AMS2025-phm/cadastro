<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Cadastro de Unidade</title>
    <style>
        body { font-family: Arial, sans-serif; background: #eef2f3; margin: 0; padding: 20px; }
        .container { background: #fff; padding: 20px; border-radius: 10px; max-width: 700px; margin: auto; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h1, h2 { text-align: center; color: #333; }
        label { display: block; margin-top: 15px; font-weight: bold; }
        input, select { width: 100%; padding: 10px; margin-top: 5px; border-radius: 5px; border: 1px solid #ccc; }
        .checkbox-group, .radio-group { display: flex; flex-direction: column; margin-top: 10px; }
        .radio-inline, .checkbox-inline { display: flex; align-items: center; margin-top: 5px; }
        .radio-inline input, .checkbox-inline input { margin-right: 8px; }
        button { margin-top: 20px; padding: 12px; width: 100%; background: #007bff; color: #fff; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
        button:hover { background: #0056b3; }
        ul { list-style-type: none; padding: 0; }
        li { background: #f9f9f9; margin: 5px 0; padding: 10px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center; }
        .medida-item { display: flex; align-items: center; gap: 10px; }
    </style>
</head>
<body>
<div class="container">
    <h1>Cadastro de Unidade</h1>
    <form method="POST" action="/salvar_unidade">
        <label for="localidade">Localidade:</label>
        <input type="text" name="localidade" required>

        <label for="unidade">Unidade:</label>
        <input type="text" name="unidade" required>

        <label for="data">Data:</label>
        <input type="date" name="data" required>

        <label for="responsavel">Responsável:</label>
        <input type="text" name="responsavel">

        <label for="qtd_func">Quantidade de Funcionários:</label>
        <input type="number" name="qtd_func" min="0">

        <label>Outras Informações:</label>
        <div class="checkbox-group">
            <label class="checkbox-inline"><input type="checkbox" name="estacionamento"> Estacionamento</label>
            <label class="checkbox-inline"><input type="checkbox" name="gramado"> Gramado</label>
            <label class="checkbox-inline"><input type="checkbox" name="curativo"> Sala de Curativo</label>
            <label class="checkbox-inline"><input type="checkbox" name="vacina"> Sala de Vacina</label>
        </div>

        <h2>Medidas</h2>
        <label for="comprimento">Comprimento (m):</label>
        <input type="number" id="comprimento" step="0.01">

        <label for="largura">Largura (m):</label>
        <input type="number" id="largura" step="0.01">

        <label>Tipo de Medida:</label>
        <div class="radio-group">
            <label class="radio-inline"><input type="radio" name="tipo_medida" value="Vidro" checked> Vidro</label>
            <label class="radio-inline"><input type="radio" name="tipo_medida" value="Sanitário-Vestiário"> Sanitário-Vestiário</label>
            <label class="radio-inline"><input type="radio" name="tipo_medida" value="Área Interna"> Área Interna</label>
            <label class="radio-inline"><input type="radio" name="tipo_medida" value="Área Externa"> Área Externa</label>
        </div>

        <button type="button" onclick="adicionarMedida()">Adicionar Medida</button>

        <ul id="listaMedidas"></ul>

        <button type="button" onclick="repetirMedidaSelecionada()">Repetir Medida Selecionada</button>

        <input type="hidden" name="medidas_json" id="medidas_json" value="[]">

        <button type="submit">Salvar Unidade</button>
    </form>

    <h1>Exportar e Enviar por E-mail</h1>
    <form method="POST" action="/exportar_excel_e_enviar_email">
        <label for="selected_unit_to_export">Unidade (Formato: Localidade - Unidade):</label>
        <input type="text" name="selected_unit_to_export" required>
        <button type="submit">Exportar e Enviar</button>
    </form>
</div>

<script>
    const medidas = [];
    let medidaSelecionada = null;

    function adicionarMedida() {
        const comp = parseFloat(document.getElementById('comprimento').value);
        const larg = parseFloat(document.getElementById('largura').value);
        const tipo = document.querySelector('input[name="tipo_medida"]:checked').value;

        if (isNaN(comp) || isNaN(larg) || comp <= 0 || larg <= 0) {
            alert("Comprimento e Largura devem ser números positivos.");
            return;
        }

        const area = (comp * larg).toFixed(2);
        const medida = {tipo: tipo, comprimento: comp, largura: larg, area: parseFloat(area)};
        medidas.push(medida);

        atualizarLista();
        document.getElementById('medidas_json').value = JSON.stringify(medidas);

        document.getElementById('comprimento').value = '';
        document.getElementById('largura').value = '';
    }

    function atualizarLista() {
        const lista = document.getElementById('listaMedidas');
        lista.innerHTML = '';
        medidas.forEach((medida, index) => {
            const li = document.createElement('li');
            const info = document.createElement('div');
            info.className = 'medida-item';

            const radio = document.createElement('input');
            radio.type = 'radio';
            radio.name = 'medidaSelecionada';
            radio.value = index;
            radio.onclick = () => medidaSelecionada = index;

            info.appendChild(radio);
            info.appendChild(document.createTextNode(`${medida.tipo}: ${medida.comprimento}m x ${medida.largura}m = ${medida.area} m²`));

            li.appendChild(info);
            lista.appendChild(li);
        });
    }

    function repetirMedidaSelecionada() {
        if (medidaSelecionada === null) {
            alert("Selecione uma medida para repetir.");
            return;
        }
        const medida = medidas[medidaSelecionada];
        medidas.push({...medida});
        atualizarLista();
        document.getElementById('medidas_json').value = JSON.stringify(medidas);
    }
</script>
</body>
</html>