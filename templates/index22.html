<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Cadastro de Unidade</title>
    <style>
        body { font-family: Arial; background: #f4f4f4; padding: 20px; }
        .container { background: #fff; padding: 20px; border-radius: 8px; max-width: 600px; margin: auto; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1, h2 { text-align: center; }
        label { display: block; margin-top: 10px; }
        input, select { width: 100%; padding: 8px; margin-top: 5px; }
        .radio-group, .checkbox-group { display: flex; flex-direction: column; margin-top: 5px; }
        .radio-inline, .checkbox-inline { display: flex; align-items: center; margin-top: 5px; }
        .radio-inline input, .checkbox-inline input { margin-right: 5px; }
        button { margin-top: 15px; padding: 10px; width: 100%; background: #007bff; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
<div class="container">
    <h1>Cadastro de Unidade</h1>
    <form method="POST" action="/salvar_unidade">
        <label for="localidade">Localidade:</label>
        <input type="text" name="localidade" required>

        <label for="unidade">Unidade:</label>
        <input type="text" name="unidade" required>

        <label for="data">Data:</label>
        <input type="date" name="data" required>

        <label for="responsavel">Responsável:</label>
        <input type="text" name="responsavel">

        <label for="qtd_func">Quantidade de Funcionários:</label>
        <input type="number" name="qtd_func" min="0">

        <h2>Medidas</h2>
        <label for="comprimento">Comprimento (m):</label>
        <input type="number" id="comprimento" step="0.01">

        <label for="largura">Largura (m):</label>
        <input type="number" id="largura" step="0.01">

        <label>Tipo de Medida:</label>
        <div class="radio-group">
            <label class="radio-inline"><input type="radio" name="tipo_medida" value="Vidro" checked> Vidro</label>
            <label class="radio-inline"><input type="radio" name="tipo_medida" value="Sanitário-Vestiário"> Sanitário-Vestiário</label>
            <label class="radio-inline"><input type="radio" name="tipo_medida" value="Área Interna"> Área Interna</label>
            <label class="radio-inline"><input type="radio" name="tipo_medida" value="Área Externa"> Área Externa</label>
        </div>

        <button type="button" onclick="adicionarMedida()">Adicionar Medida</button>
        <button type="button" onclick="repetirUltimaMedida()">Repetir Última Medida</button>

        <ul id="listaMedidas"></ul>

        <input type="hidden" name="medidas_json" id="medidas_json" value="[]">

        <button type="submit">Salvar Unidade</button>
    </form>

    <h1>Exportar e Enviar por E-mail</h1>
    <form method="POST" action="/exportar_excel_e_enviar_email">
        <label for="selected_unit_to_export">Unidade (Formato: Localidade - Unidade):</label>
        <input type="text" name="selected_unit_to_export" required>
        <button type="submit">Exportar e Enviar</button>
    </form>
</div>

<script>
    const medidas = [];
    let ultimaMedida = null;

    function adicionarMedida() {
        const comp = parseFloat(document.getElementById('comprimento').value);
        const larg = parseFloat(document.getElementById('largura').value);
        const tipo = document.querySelector('input[name="tipo_medida"]:checked').value;

        if (isNaN(comp) || isNaN(larg) || comp <= 0 || larg <= 0) {
            alert("Comprimento e Largura devem ser números positivos.");
            return;
        }

        const area = (comp * larg).toFixed(2);
        const medida = {tipo: tipo, comprimento: comp, largura: larg, area: parseFloat(area)};
        medidas.push(medida);
        ultimaMedida = medida;

        const li = document.createElement('li');
        li.textContent = `${tipo}: ${comp}m x ${larg}m = ${area} m²`;
        document.getElementById('listaMedidas').appendChild(li);

        document.getElementById('medidas_json').value = JSON.stringify(medidas);

        document.getElementById('comprimento').value = '';
        document.getElementById('largura').value = '';
    }

    function repetirUltimaMedida() {
        if (!ultimaMedida) {
            alert("Nenhuma medida para repetir.");
            return;
        }
        medidas.push({...ultimaMedida});
        const li = document.createElement('li');
        li.textContent = `${ultimaMedida.tipo}: ${ultimaMedida.comprimento}m x ${ultimaMedida.largura}m = ${ultimaMedida.area} m² (Repetida)`;
        document.getElementById('listaMedidas').appendChild(li);
        document.getElementById('medidas_json').value = JSON.stringify(medidas);
    }
</script>
</body>
</html>